<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MAWARAN CO</title>

<style>
body{
  font-family: Tahoma, Arial;
  background:#f2f4f7;
  margin:0;
  padding:15px;
}
.container{
  max-width:420px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.12);
}
h2{text-align:center;}
label{
  font-size:14px;
  margin-top:10px;
  display:block;
}
.req{color:red;font-weight:bold;}
input,select,textarea,button{
  width:100%;
  padding:12px;
  margin-top:5px;
  font-size:15px;
  border-radius:6px;
  border:1px solid #ccc;
}
textarea{resize:none;}
button{
  background:#007bff;
  color:#fff;
  border:none;
  margin-top:15px;
}
button:disabled{background:#aaa;}
.info{
  background:#eef3ff;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  font-size:14px;
  text-align:center;
}
.loading{text-align:center;color:#d00;margin-top:10px;}
.preview img{max-width:100%;border-radius:8px;margin-top:10px;}
</style>
</head>

<body>

<!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ -->
<div class="container" id="loginBox">
  <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨</h2>

  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ <span class="req">*</span></label>
  <input id="repInput">

  <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© <span class="req">*</span></label>
  <input id="cityInput">

  <button onclick="saveRep()">ØªØ³Ø¬ÙŠÙ„</button>
</div>

<!-- Ø§Ù„ÙÙˆØ±Ù… -->
<div class="container" id="formBox" style="display:none;">

  <div class="info">
    ğŸ‘¤ <b id="repShow"></b> | ğŸ“ <b id="cityShow"></b>
  </div>

  <h2>MAWARAN CO</h2>

  <label>Ù‡Ù„ ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø²ÙŠØªØŸ <span class="req">*</span></label>
  <select id="useOil">
    <option value="">Ø§Ø®ØªØ±</option>
    <option value="Ù†Ø¹Ù…">Ù†Ø¹Ù…</option>
    <option value="Ù„Ø§">Ù„Ø§</option>
  </select>

  <label>Ø§Ù„ÙØ¦Ø© <span class="req">*</span></label>
  <select id="category">
    <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø©</option>
  </select>

  <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ <span class="req">*</span></label>
  <input id="trade">

  <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ <span class="req">*</span></label>
  <input id="owner">

  <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <span class="req">*</span></label>
  <input id="address">

  <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span class="req">*</span></label>
  <input id="phone" type="tel">

  <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª <span class="req">*</span></label>
  <textarea id="note"></textarea>

  <label>Ø§Ù„ØªÙ‚ÙŠÙŠÙ… <span class="req">*</span></label>
  <select id="rating">
    <option value="">Ø§Ø®ØªØ±</option>
    <option value="1">â­</option>
    <option value="2">â­â­</option>
    <option value="3">â­â­â­</option>
    <option value="4">â­â­â­â­</option>
    <option value="5">â­â­â­â­â­</option>
  </select>

  <label>Ø£ÙŠØ§Ù… Ø§Ù„Ø²ÙŠØ§Ø±Ø© <span class="req">*</span></label>
  <input id="visitDays" type="number">

  <!-- ØºÙŠØ± Ø¥Ù„Ø²Ø§Ù…ÙŠØ© -->
  <label>Ù†ÙˆØ¹ Ø§Ù„Ø²ÙŠØª</label>
  <input id="oilType">

  <label>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø²ÙŠØª</label>
  <input id="oilGrade">

  <label>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©</label>
  <select id="distance">
    <option value="">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</option>
    <option value="3 ÙƒÙ…">3 ÙƒÙ…</option>
    <option value="5 ÙƒÙ…">5 ÙƒÙ…</option>
    <option value="10 ÙƒÙ…">10 ÙƒÙ…</option>
    <option value="15 ÙƒÙ…">15 ÙƒÙ…</option>
  </select>

  <label>Ø³Ø¹Ø± Ø§Ù„Ù„ØªØ±</label>
  <input id="price" type="number">

  <label>Ø§Ù„ØµÙˆØ±Ø© <span class="req">*</span></label>
  <input id="imageInput" type="file" accept="image/*" capture="environment">
  <div class="preview" id="preview"></div>

  <button id="sendBtn" onclick="sendData()">Ø¥Ø±Ø³Ø§Ù„</button>
  <div class="loading" id="loading"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyKH7ayK_oYC1TROqFOyChIBQoktELaXAHEcTlqEpjhVLOAIELVRb9tWPpo3PJUyzba/exec";
let imageBase64 = "";

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ¦Ø§Øª */
fetch(SCRIPT_URL + "?action=categories")
  .then(r=>r.json())
  .then(data=>{
    data.forEach(c=>{
      const op=document.createElement("option");
      op.value=c;
      op.textContent=c;
      category.appendChild(op);
    });
  });

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ù†Ø¯ÙˆØ¨ */
function saveRep(){
  if(!repInput.value.trim() || !cityInput.value.trim()){
    alert("Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø¥Ù„Ø²Ø§Ù…ÙŠØ©");
    return;
  }
  localStorage.setItem("repName",repInput.value.trim());
  localStorage.setItem("city",cityInput.value.trim());
  showForm();
}

function showForm(){
  loginBox.style.display="none";
  formBox.style.display="block";
  repShow.textContent=localStorage.getItem("repName");
  cityShow.textContent=localStorage.getItem("city");
}

/* Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø© */
imageInput.addEventListener("change",()=>{
  const file=imageInput.files[0];
  if(!file) return;

  const reader=new FileReader();
  reader.onload=e=>{
    imageBase64=e.target.result;
    preview.innerHTML=`<img src="${imageBase64}">`;
  };
  reader.readAsDataURL(file);
});

/* Ø¥Ø±Ø³Ø§Ù„ */
function sendData(){

  const required=[
    useOil, category, trade, owner, address,
    phone, note, rating, visitDays
  ];

  for(let f of required){
    if(!f.value.trim()){
      alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ù„Ø²Ø§Ù…ÙŠØ© (*)");
      return;
    }
  }

  if(!imageBase64){
    alert("Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ø²Ø§Ù…ÙŠØ©");
    return;
  }

  sendBtn.disabled=true;
  loading.textContent="Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...";

  navigator.geolocation.getCurrentPosition(pos=>{
    const fd=new FormData();
    fd.append("rep",localStorage.getItem("repName"));
    fd.append("city",localStorage.getItem("city"));
    fd.append("useOil",useOil.value);
    fd.append("category",category.value);
    fd.append("trade",trade.value);
    fd.append("owner",owner.value);
    fd.append("address",address.value);
    fd.append("phone",phone.value);
    fd.append("note",note.value);
    fd.append("rating",rating.value);
    fd.append("visitDays",visitDays.value);
    fd.append("oilType",oilType.value);
    fd.append("oilGrade",oilGrade.value);
    fd.append("distance",distance.value);
    fd.append("price",price.value);
    fd.append("lat",pos.coords.latitude);
    fd.append("lng",pos.coords.longitude);
    fd.append("imageBase64",imageBase64);

    fetch(SCRIPT_URL,{method:"POST",body:fd})
      .then(()=>{alert("ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­");location.reload();})
      .catch(()=>{alert("Ø®Ø·Ø£ Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„");sendBtn.disabled=false;});
  });
}

/* Ø¯Ø®ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ */
if(localStorage.getItem("repName")&&localStorage.getItem("city")){
  showForm();
}
</script>

</body>
</html>
