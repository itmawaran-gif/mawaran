<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ø¨Ø­Ø« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</title>

  <style>
    body {
      font-family: Tahoma, Arial;
      background: #f0f2f5;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    h1, h2, h3 {
      text-align: center;
    }
    .price {
      text-align: center;
      font-size: 26px;
      color: #198754;
      font-weight: bold;
      margin: 10px 0;
    }
    .total {
      text-align: center;
      font-size: 20px;
      margin-bottom: 15px;
    }
    .search-box {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    input {
      padding: 15px;
      font-size: 18px;
      border-radius: 8px;
      border: 1px solid #ccc;
      text-align: center;
    }
    .buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    button {
      padding: 14px 25px;
      font-size: 18px;
      border: none;
      border-radius: 8px;
      background: #007bff;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    #cameraContainer {
      margin-top: 20px;
      max-width: 400px;
      margin-inline: auto;
    }
    .result {
      margin-top: 20px;
      background: #fafafa;
      padding: 15px;
      border-radius: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #eee;
    }
    .loading {
      text-align: center;
      font-weight: bold;
    }
    .error {
      color: red;
      font-weight: bold;
      text-align: center;
    }
  </style>

  <script src="https://unpkg.com/html5-qrcode"></script>
</head>

<body>
<div class="container">
  <h1>MAWARAN co</h1>
  <h2>Store</h2>

  <div class="search-box">
    <input id="searchInput" type="text"
      placeholder="Ø¨Ø§Ø±ÙƒÛ†Ø¯Û•Ú©Û• Ø³Ú©Ø§Ù† Ø¨Ú©Û• ÛŒØ§Ù† Ú©Û†Ø¯ÛŒ Ø¨Ø§Ø¨Û•ØªÛ•Ú©Û• Ø¯Ø§Ø®Úµ Ø¨Ú©Û•">

    <div class="buttons">
      <button id="searchButton">ğŸ” Ø¨Ø­Ø«</button>
      <button id="scanButton">ğŸ“· ÙƒØ§Ù…ÙŠØ±Ø§</button>
    </div>
  </div>

  <div id="cameraContainer"></div>
  <div class="result" id="result"></div>
</div>

<script>
const STOCK_API_URL = "https://script.google.com/macros/s/AKfycbxCSQ1nUnbo99kTNDWMZyDN7s5UFTWztPuzHvAMSgMldPPAEMmgrx1GgIlzNGKRVPULEg/exec";
let html5QrCode;

async function fetchStock(code) {
  const res = await fetch(`${STOCK_API_URL}?code=${encodeURIComponent(code)}`);
  return await res.json();
}

async function searchStockOnly(code) {
  if (!code) return;
  const resultDiv = document.getElementById("result");
  resultDiv.innerHTML = "<p class='loading'>â³ Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø«...</p>";

  const data = await fetchStock(code);

  if (!data || !data.items.length) {
    resultDiv.innerHTML = "<p class='error'>âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±ØµÙŠØ¯</p>";
    return;
  }

  let total = 0;
  let html = `<h3>${data.name}</h3>`;
  html += `<div class="price">ğŸ’° Ø§Ù„Ø³Ø¹Ø±: ${data.price ?? "ØºÙŠØ± Ù…ØªÙˆÙØ±"}</div>`;

  data.items.forEach(i => total += Number(i.balance) || 0);
  html += `<div class="total">ğŸ“¦ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„ÙƒÙ„ÙŠØ©: ${total}</div>`;

  html += `<table>
    <tr><th>Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th></tr>`;

  data.items.forEach(i => {
    html += `<tr><td>${i.warehouse}</td><td>${i.balance}</td></tr>`;
  });

  html += `</table>`;
  resultDiv.innerHTML = html;
}

document.getElementById("searchInput").addEventListener("keydown", e => {
  if (e.key === "Enter") searchStockOnly(e.target.value.trim());
});
document.getElementById("searchButton").onclick = () =>
  searchStockOnly(searchInput.value.trim());

async function startBarcodeScanner() {
  html5QrCode = new Html5Qrcode("cameraContainer");
  const cams = await Html5Qrcode.getCameras();
  html5QrCode.start(cams[0].id, { fps: 10, qrbox: 250 }, txt => {
    html5QrCode.stop();
    searchStockOnly(txt);
  });
}
document.getElementById("scanButton").onclick = startBarcodeScanner;
</script>
</body>
</html>
